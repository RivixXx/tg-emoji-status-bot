‚ùó 1. CHATS_HISTORY ‚Äî –ø–∞–º—è—Ç—å –≤ RAM
CHATS_HISTORY = {}

–≠—Ç–æ:

–ü–æ—Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ—Å—Ç–∞—Ä—Ç–µ

–ù–µ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è

–ù–µ thread-safe –ø—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–æ—Ä–∫–µ—Ä–∞—Ö

–ú–æ–∂–µ—Ç —Ä–∞–∑—Ä–∞—Å—Ç–∏—Å—å –≤ –¥–æ–ª–≥–æ–∂–∏–≤—É—â–µ–º –ø—Ä–æ—Ü–µ—Å—Å–µ

üëâ –î–ª—è single-user ‚Äî –Ω–æ—Ä–º
üëâ –î–ª—è SaaS ‚Äî –Ω—É–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ Redis

‚ùó 2. Tool execution –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–º tool_call

–°–µ–π—á–∞—Å:

for tool_call in message["tool_calls"]:
    ...
    return res

–ï—Å–ª–∏ –º–æ–¥–µ–ª—å –≤—ã–∑–æ–≤–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏–π –ø–æ–¥—Ä—è–¥, –æ–Ω–∏ –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞—é—Ç—Å—è.

–õ—É—á—à–µ:

–í—ã–ø–æ–ª–Ω–∏—Ç—å –≤—Å–µ tool calls

–î–æ–±–∞–≤–∏—Ç—å –∏—Ö –æ—Ç–≤–µ—Ç—ã –≤ messages

–°–¥–µ–ª–∞—Ç—å –≤—Ç–æ—Ä–æ–π LLM –≤—ã–∑–æ–≤ (–∫–∞–∫ OpenAI tool loop pattern)

‚ùó 3. –ù–µ—Ç —Ç–∞–π–º–∞—É—Ç–∞ –Ω–∞ tool execution

–ï—Å–ª–∏ Google API –∑–∞–≤–∏—Å–Ω–µ—Ç ‚Äî –≤—Å—ë –ø–æ–≤–∏—Å–Ω–µ—Ç.

–õ—É—á—à–µ:

await asyncio.wait_for(create_event(...), timeout=10)
‚ùó 4. Circuit Breaker –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
if time.time() - self.last_failure_time > self.recovery_time:
    return True

–û–Ω –¥–∞—ë—Ç —à–∞–Ω—Å, –Ω–æ –Ω–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç is_open.

–ú–µ–ª–æ—á—å, –Ω–æ –ª–æ–≥–∏—á–µ—Å–∫–∏ –Ω–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ.

‚ùó 5. –ù–µ—Ç user_id —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –≤ search_memories

–°–µ–π—á–∞—Å –ø–æ–∏—Å–∫ –≥–ª–æ–±–∞–ª—å–Ω—ã–π.

–ï—Å–ª–∏ —É —Ç–µ–±—è –±—É–¥–µ—Ç 10 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π ‚Äî
–æ–Ω–∏ —Å–º–æ–≥—É—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å —á—É–∂—É—é –ø–∞–º—è—Ç—å.

–ù—É–∂–Ω–æ:

"filter": {"user_id": chat_id}

–∏–ª–∏ Supabase SQL WHERE.

–≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –±—É–¥—É—â–µ–≥–æ SaaS.

‚ùó 6. –ö–∞–∂–¥—ã–π embedding —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π AsyncClient
async with httpx.AsyncClient()

–¢—ã —Å–æ–∑–¥–∞—ë—à—å TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫–∞–∂–¥—ã–π —Ä–∞–∑.

–õ—É—á—à–µ:

–°–æ–∑–¥–∞—Ç—å global client

–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ

‚ö†Ô∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞

Google API –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ –≤–Ω—É—Ç—Ä–∏ async —Ñ—É–Ω–∫—Ü–∏–∏.

service.events().list().execute()

–≠—Ç–æ –±–ª–æ–∫–∏—Ä—É–µ—Ç event loop.

–í high-load —Ä–µ–∂–∏–º–µ –≤—Å—ë –≤—Å—Ç–∞–Ω–µ—Ç.

–†–µ—à–µ–Ω–∏–µ:

await asyncio.to_thread(service.events().list(...).execute)

‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞

–ï—Å–ª–∏ –ø—Ä–æ—Ü–µ—Å—Å —É–ø–∞–¥—ë—Ç ‚Äî
–≤—Å–µ escalation asyncio.Task –ø—Ä–æ–ø–∞–¥—É—Ç.

–¢—ã —Å–æ—Ö—Ä–∞–Ω—è–µ—à—å reminders –≤ –ë–î ‚Äî —ç—Ç–æ –æ—Ç–ª–∏—á–Ω–æ.

–ù–æ –Ω—É–∂–Ω–æ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ:

–∑–∞–≥—Ä—É–∑–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ

–ø—Ä–æ–≤–µ—Ä–∏—Ç—å scheduled_time

–ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å escalation loop

–ï—Å–ª–∏ —ç—Ç–æ –µ—Å—Ç—å –≤ main ‚Äî —Ç—ã –∫—Ä–∞—Å–∞–≤–µ—Ü.
–ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å.

üèó –¢–µ–ø–µ—Ä—å —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π –≤–∑–≥–ª—è–¥ –Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—É

–°–µ–π—á–∞—Å —É —Ç–µ–±—è:

auras/
brains/
skills/
static/

–≠—Ç–æ –ª–æ–≥–∏—á–µ—Å–∫–∏ –ø–æ–Ω—è—Ç–Ω–æ, –Ω–æ —è –±—ã —Å–º–æ—Ç—Ä–µ–ª –¥–∞–ª—å—à–µ.

1Ô∏è‚É£ –†–∞–∑–¥–µ–ª–∏—Ç—å ‚Äú—è–¥—Ä–æ‚Äù –∏ ‚Äú–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏‚Äù

–°–µ–π—á–∞—Å brains —Å–º–µ—à–∏–≤–∞–µ—Ç:

AI

Weather

News

Health

Calendar

–≠—Ç–æ –≤—Å—ë –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ + –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏.

–ú–æ–∂–Ω–æ –≤—ã–¥–µ–ª–∏—Ç—å:

core/
    ai_engine.py
    state.py
    supervisor.py

services/
    weather_service.py
    news_service.py
    calendar_service.py
    health_service.py

–≠—Ç–æ –¥–∞—Å—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å.

2Ô∏è‚É£ –î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–π domain

–ï—Å–ª–∏ —Ç—ã –¥—É–º–∞–µ—à—å –æ SaaS:

domain/
    user.py
    reminder.py
    health_record.py
    calendar_event.py

–≠—Ç–æ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç —Å–∏—Å—Ç–µ–º—É –∏–∑ ‚Äú—Å–∫—Ä–∏–ø—Ç–∞‚Äù –≤ ‚Äú–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É‚Äù.

3Ô∏è‚É£ –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö?

–ï—Å–ª–∏ —É —Ç–µ–±—è –ø–æ–∫–∞ —Å–ª–æ–≤–∞—Ä–∏ ‚Äî
—Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî dataclass –∏–ª–∏ pydantic models.

–≠—Ç–æ —Å—Ä–∞–∑—É –ø–æ–¥–Ω–∏–º–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞.