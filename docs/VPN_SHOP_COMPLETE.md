# üíé Karina VPN Shop ‚Äî –ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

**–í–µ—Ä—Å–∏—è:** 1.0  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready  
**–°—Ç–∏–ª—å:** Dark Cyberpunk / Professional Space UI

---

## üìã –û–±–∑–æ—Ä

**Karina VPN Shop** ‚Äî —ç—Ç–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–∞–∂–∏ VPN-–¥–æ—Å—Ç—É–ø–æ–≤ —á–µ—Ä–µ–∑ Telegram-–±–æ—Ç–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–µ–π –∫–ª—é—á–µ–π —á–µ—Ä–µ–∑ Marzban API.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- ‚úÖ Inline-–º–µ–Ω—é —Å –±–∞–Ω–Ω–µ—Ä–∞–º–∏
- ‚úÖ –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂ (4 —à–∞–≥–∞)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–µ–π
- ‚úÖ –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞ (10%)
- ‚úÖ Revenue Share –¥–ª—è –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤
- ‚úÖ –ë–∞–ª–∞–Ω—Å –∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏–µ (–°–ë–ü, Crypto)
- ‚úÖ FAQ –∏ –ü–æ–¥–¥–µ—Ä–∂–∫–∞

---

## üéØ –ö–æ–Ω—Ü–µ–ø—Ü–∏—è "–î–≤–æ–π–Ω–æ–µ –¥–Ω–æ"

### –î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

–ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ **–¥–≤—É—Ö —Ä–µ–∂–∏–º–∞—Ö** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `user_id`:

| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | –†–µ–∂–∏–º | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------------|-------|----------|
| **MY_ID** (–≤–ª–∞–¥–µ–ª–µ—Ü) | –®—Ç–∞—Ç–Ω—ã–π | AI, –∫–∞–ª–µ–Ω–¥–∞—Ä—å, –∑–¥–æ—Ä–æ–≤—å–µ, –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å |
| **–õ—é–±–æ–π –¥—Ä—É–≥–æ–π ID** | VPN Shop | Dark Cyberpunk –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø—Ä–æ–¥–∞–∂–∏ VPN |

### –ú–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

```python
@bot_client.on(events.NewMessage(
    func=lambda e: e.is_private and e.sender_id != MY_ID
))
async def vpn_stranger_interceptor(event):
    """–ü–µ—Ä–µ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —á—É–∂–∏—Ö ID"""
    user_id = event.sender_id
    user = await get_user_fast(user_id)
    
    if user["state"] == "REGISTERED":
        await event.respond(
            get_main_menu_text(user),
            buttons=get_main_menu_keyboard()
        )
    
    raise events.StopPropagation  # –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ AI
```

**–í–∞–∂–Ω–æ:** `raise events.StopPropagation` –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç —Å—Ä–∞–±–∞—Ç—ã–≤–∞–Ω–∏–µ AI –∏ —ç–∫–æ–Ω–æ–º–∏—Ç —Ç–æ–∫–µ–Ω—ã Mistral.

---

## üé® UX/UI –î–∏–∑–∞–π–Ω

### –°—Ç–∏–ª—å

**Dark Cyberpunk / Professional Space UI**

- –¢—ë–º–Ω—ã–π —Ñ–æ–Ω (#1a2b3c)
- –ù–µ–æ–Ω–æ–≤—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã (cyan, turquoise)
- ASCII-—Ä–∞–º–∫–∏ —Å emoji
- Inline-–∫–Ω–æ–ø–∫–∏ –≤–º–µ—Å—Ç–æ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö

### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë       üåå  KARINA VPN  üåå      ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ **Karina VPN**! üöÄ

–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–¥–µ–ª –º–µ–Ω—é:

[üíé –¢–∞—Ä–∏—Ñ—ã]
[üí≥ –ë–∞–ª–∞–Ω—Å]
[üë§ –ü—Ä–æ—Ñ–∏–ª—å]
[üìñ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏]
[üì• –°–∫–∞—á–∞—Ç—å]
[üíº –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞]
[‚ùì FAQ] [üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞]
```

### –†–∞–∑–¥–µ–ª—ã

#### 1. –¢–∞—Ä–∏—Ñ—ã

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë         üíé  –¢–ê–†–ò–§–´  üíé        ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

[üíé 1 –ú–µ—Å—è—Ü ‚Äî 150 ‚ÇΩ]
[üíé 3 –ú–µ—Å—è—Ü–∞ ‚Äî 400 ‚ÇΩ]
[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

#### 2. –ë–∞–ª–∞–Ω—Å

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë        üí≥  –ë–ê–õ–ê–ù–°  üí≥         ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üí≥ **–í–∞—à –±–∞–ª–∞–Ω—Å:** `0 ‚ÇΩ`

üí° **–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ:**
–†–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–µ –æ—Ç—á–∏—Å–ª–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ 
–∑–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ —ç—Ç–æ—Ç —Å—á—ë—Ç.

[üí∞ –ü–æ–ø–æ–ª–Ω–∏—Ç—å (–°–ë–ü)]
[‚Çø –ü–æ–ø–æ–ª–Ω–∏—Ç—å (Crypto)]
[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

#### 3. –ü—Ä–æ—Ñ–∏–ª—å

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë        üë§  –ü–†–û–§–ò–õ–¨  üë§        ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üìß **Email:** `user@example.com`
üÜî **ID:** `7480815681`
üí≥ **–ë–∞–ª–∞–Ω—Å:** `0 ‚ÇΩ`

[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

#### 4. –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë     üìñ  –ò–ù–°–¢–†–£–ö–¶–ò–ò  üìñ        ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üìò **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç:**

**1.** –°–∫–∞—á–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
**2.** –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á
**3.** –í—Å—Ç–∞–≤—å—Ç–µ –∫–ª—é—á –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
**4.** –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å

[ü§ñ Android]
[üì± iOS]
[üíª Windows]
[üçé macOS]
[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

#### 5. –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  üíº  –†–ï–§–ï–†–ê–õ–¨–ù–ê–Ø –ü–†–û–ì–†–ê–ú–ú–ê   ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üë• **–í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
‚îú‚îÄ –ü—Ä–∏–≥–ª–∞—à–µ–Ω–æ –¥—Ä—É–∑–µ–π: `0`
‚îî‚îÄ –ó–∞—Ä–∞–±–æ—Ç–∞–Ω–æ: `0 ‚ÇΩ`

üí∞ **–ù–∞ –±–∞–ª–∞–Ω—Å–µ:** `0 ‚ÇΩ`

üéÅ **–£—Å–ª–æ–≤–∏—è:**
‚Ä¢ –î—Ä—É–≥ –ø–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ VPN
‚Ä¢ –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ 10% –æ—Ç –µ–≥–æ –ø–æ–∫—É–ø–æ–∫
‚Ä¢ –î–µ–Ω—å–≥–∏ –∑–∞—á–∏—Å–ª—è—é—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å

üîó **–í–∞—à–∞ —Å—Å—ã–ª–∫–∞:**
`https://t.me/your_bot?start=7480815681`

[üìã –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É]
[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

#### 6. FAQ

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë          ‚ùì  FAQ  ‚ùì          ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

–í—ã–±–µ—Ä–∏ –≤–æ–ø—Ä–æ—Å, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –æ—Ç–≤–µ—Ç:

[üåê –ß—Ç–æ —Ç–∞–∫–æ–µ Karina VPN?]
[üì± –ö–∞–∫ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è?]
[üì≤ –ù–∞ —Å–∫–æ–ª—å–∫–∏—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö?]
[üá∑üá∫ –†–∞–±–æ—Ç–∞–µ—Ç –≤ –†–æ—Å—Å–∏–∏?]
[‚ö°Ô∏è –ö–∞–∫–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å?]
[üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ –ª–∏?]
[üí° –°–æ–≤–µ—Ç—ã –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏]
[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

#### 7. –ü–æ–¥–¥–µ—Ä–∂–∫–∞

```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë     üí¨  –ü–û–î–î–ï–†–ñ–ö–ê  üí¨         ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

–í–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ —á—Ç–æ-—Ç–æ 
—Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ —Ç–∞–∫? –ù–∞–ø–∏—à–∏ –Ω–∞–º.

–ü—Ä–µ–∂–¥–µ —á–µ–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è, –∑–∞–≥–ª—è–Ω–∏ –≤ 
**FAQ** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, —Ä–µ—à–µ–Ω–∏–µ —É–∂–µ 
–∂–¥—ë—Ç —Ç–µ–±—è —Ç–∞–º.

[‚ùì FAQ]
[‚úçÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å]
[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

---

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –í–æ—Ä–æ–Ω–∫–∞ –ø—Ä–æ–¥–∞–∂ (4 —à–∞–≥–∞)

#### –®–∞–≥ 1: –û—Ñ–µ—Ä—Ç–∞

```python
if state == "NEW":
    welcome_text = "üìÑ **–ü—É–±–ª–∏—á–Ω–∞—è –æ—Ñ–µ—Ä—Ç–∞**\n\n..."
    keyboard = [
        [Button.inline("‚úÖ –ü—Ä–∏–Ω–∏–º–∞—é —É—Å–ª–æ–≤–∏—è", b"accept_offer")],
        [Button.inline("‚ùå –û—Ç–º–µ–Ω–∏—Ç—å", b"decline_offer")]
    ]
    await event.respond(welcome_text, buttons=keyboard)
```

#### –®–∞–≥ 2: Email

```python
elif state == "WAITING_EMAIL":
    if re.match(r"[^ @]+@[^ @]+\.[^ @]+", text):
        code = str(random.randint(1000, 9999))
        
        # Fire-and-Forget: –ë–î –≤ —Ñ–æ–Ω–µ
        fire_and_forget(
            mcp_vpn_update_user_state(
                user_id, "WAITING_CODE", 
                email=text, code=code
            )
        )
        
        await event.respond(
            f"‚úÖ **–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ {text}**\n\n"
            f"*(–î–õ–Ø –¢–ï–°–¢–ê - –¢–í–û–ô –ö–û–î: {code})*"
        )
```

#### –®–∞–≥ 3: –ö–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

```python
elif state == "WAITING_CODE":
    if text == user["verification_code"]:
        # –ú–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞
        update_user_cache(user_id, {"state": "REGISTERED"})
        
        # –ë–î –≤ —Ñ–æ–Ω–µ
        fire_and_forget(
            mcp_vpn_update_user_state(user_id, "REGISTERED")
        )
        
        await event.respond(
            "üéâ **[ –î–û–°–¢–£–ü –†–ê–ó–†–ï–®–ï–ù ]**",
            buttons=get_main_menu_keyboard()
        )
```

#### –®–∞–≥ 4: –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

```python
elif state == "REGISTERED":
    await event.respond(
        get_main_menu_text(user),
        buttons=get_main_menu_keyboard()
    )
```

---

## üí∞ –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –¢–∞—Ä–∏—Ñ—ã

| –ü–µ—Ä–∏–æ–¥ | –¶–µ–Ω–∞ | –í—ã–≥–æ–¥–∞ | –ú–∞—Ä–∂–∏–Ω–∞–ª—å–Ω–æ—Å—Ç—å |
|--------|------|--------|----------------|
| 1 –º–µ—Å—è—Ü | 150 ‚ÇΩ | ‚Äî | 100% |
| 3 –º–µ—Å—è—Ü–∞ | 400 ‚ÇΩ | 50 ‚ÇΩ | 100% |
| 6 –º–µ—Å—è—Ü–µ–≤ | 750 ‚ÇΩ | 150 ‚ÇΩ | 100% |
| 12 –º–µ—Å—è—Ü–µ–≤ | 1400 ‚ÇΩ | 400 ‚ÇΩ | 100% |

**–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å:** 0 ‚ÇΩ (—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä VPS)

### –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è –ø—Ä–æ–≥—Ä–∞–º–º–∞

**–£—Ä–æ–≤–Ω–∏:**

| –†–µ—Ñ–µ—Ä–∞–ª–æ–≤ | % –æ—Ç –ø–æ–∫—É–ø–æ–∫ | Revenue Share |
|-----------|--------------|---------------|
| 0-1000 | 10% | 20% |
| 3000+ | 10% | 25% |
| 5000+ | 10% | 30% |
| 10 000+ | 10% | 40% |
| 15 000+ | 10% | 50% |

**–ü—Ä–∏–º–µ—Ä:**
- –ü—Ä–∏–≤–µ–¥—ë–Ω –¥—Ä—É–≥
- –î—Ä—É–≥ –∫—É–ø–∏–ª 3 –º–µ—Å—è—Ü–∞ (400 ‚ÇΩ)
- –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ: 400 √ó 10% = **40 ‚ÇΩ** –Ω–∞ –±–∞–ª–∞–Ω—Å

### Revenue Share (–ø–∞—Ä—Ç–Ω—ë—Ä–∫–∞)

**–î–ª—è –∫—Ä—É–ø–Ω—ã—Ö –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤ (3000+ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤):**

- 20-50% –æ—Ç **–¥–æ—Ö–æ–¥–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã**
- –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ —É—Å–ª–æ–≤–∏—è
- –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä

---

## üîå Marzban API Integration

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞

```python
# brains/vpn_api.py

async def create_user(self, username: str) -> dict:
    """–°–æ–∑–¥–∞—ë—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ Marzban"""
    url = f"{self.base_url}/api/user"
    
    payload = {
        "username": username,
        "expire": 0,  # –ë–µ—Å—Å—Ä–æ—á–Ω–æ
        "data_limit": 0  # –ë–µ–∑–ª–∏–º–∏—Ç
    }
    
    async with httpx.AsyncClient() as client:
        response = await client.post(
            url,
            json=payload,
            headers={"Authorization": f"Bearer {self.token}"}
        )
        
        return response.json()
```

### –ü–æ–ª—É—á–µ–Ω–∏–µ VLESS –∫–ª—é—á–∞

```python
async def get_user(self, username: str) -> dict:
    """–ü–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–≤–∫–ª—é—á–∞—è –∫–ª—é—á)"""
    url = f"{self.base_url}/api/user/{username}"
    
    async with httpx.AsyncClient() as client:
        response = await client.get(
            url,
            headers={"Authorization": f"Bearer {self.token}"}
        )
        
        data = response.json()
        return {
            "success": True,
            "vless_link": data.get("links", {}).get("vless"),
            "expire": data.get("expire"),
            "data_limit": data.get("data_limit")
        }
```

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ–ø–ª–∞—Ç—ã

```python
elif data.startswith("checkpay_"):
    months = int(data.split("_")[1])
    amount = 150 if months == 1 else 400
    
    # 1. –°–æ–∑–¥–∞—ë–º –∑–∞–∫–∞–∑ –≤ –ë–î
    order = await mcp_vpn_create_order(sender_id, months, amount)
    
    # 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –∫–ª—é—á —á–µ—Ä–µ–∑ Marzban
    result = await check_payment_and_issue_key(sender_id, months)
    
    if result.get("success"):
        vless_key = result.get("vless_key")
        
        # 3. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–ª—é—á —Å QR-–∫–æ–¥–æ–º
        qr = qrcode.QRCode()
        qr.add_data(vless_key)
        img = qr.make_image()
        
        await bot_client.send_file(
            event.chat_id,
            file=io.BytesIO(img.to_bytes()),
            caption=f"üü¢ **[ –¢–†–ê–ù–ó–ê–ö–¶–ò–Ø –ü–û–î–¢–í–ï–†–ñ–î–ï–ù–ê ]**\n\n–ö–ª—é—á: `{vless_key}`"
        )
```

---

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –¢–∞–±–ª–∏—Ü–∞: vpn_shop_users

```sql
CREATE TABLE vpn_shop_users (
    user_id BIGINT PRIMARY KEY,
    state TEXT DEFAULT 'NEW',  -- NEW, WAITING_EMAIL, WAITING_CODE, REGISTERED
    email TEXT,
    verification_code TEXT,
    balance DECIMAL DEFAULT 0,
    vless_key TEXT,
    referred_by BIGINT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### –¢–∞–±–ª–∏—Ü–∞: vpn_shop_orders

```sql
CREATE TABLE vpn_shop_orders (
    id SERIAL PRIMARY KEY,
    user_id BIGINT REFERENCES vpn_shop_users(user_id),
    months INT,
    amount DECIMAL,
    status TEXT,  -- pending, completed, cancelled
    vless_key TEXT,
    created_at TIMESTAMP DEFAULT NOW()
);
```

### –¢–∞–±–ª–∏—Ü–∞: vpn_shop_referrals

```sql
CREATE TABLE vpn_shop_referrals (
    id SERIAL PRIMARY KEY,
    referrer_id BIGINT REFERENCES vpn_shop_users(user_id),
    referred_id BIGINT REFERENCES vpn_shop_users(user_id),
    commission DECIMAL,
    created_at TIMESTAMP DEFAULT NOW()
);
```

---

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–£—Ä–æ–≤–Ω–∏ 1-3)

### –£—Ä–æ–≤–µ–Ω—å 1: In-Memory Cache

**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–∞–∂–¥—ã–π –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ ‚Üí –∑–∞–ø—Ä–æ—Å –≤ –ë–î (0.3-0.5 —Å–µ–∫)

**–†–µ—à–µ–Ω–∏–µ:**

```python
USER_CACHE = {}
CACHE_TTL = 300  # 5 –º–∏–Ω—É—Ç

async def get_user_fast(user_id):
    now = time.time()
    if user_id in USER_CACHE and (now - USER_CACHE[user_id]['time'] < CACHE_TTL):
        return USER_CACHE[user_id]['data']  # 0.0001 —Å–µ–∫
    
    user = await mcp_vpn_get_user(user_id)  # 0.3 —Å–µ–∫
    USER_CACHE[user_id] = {'data': user, 'time': now}
    return user
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** 99% –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–∑ –ø–∞–º—è—Ç–∏ –∑–∞ 0.0001 —Å–µ–∫

### –£—Ä–æ–≤–µ–Ω—å 2: Smart Typewriter

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –º–≥–Ω–æ–≤–µ–Ω–Ω–æ ‚Äî –Ω–µ–µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ

**–†–µ—à–µ–Ω–∏–µ:**

```python
async def send_with_typewriter(event, text):
    async with event.client.action(event.chat_id, 'typing'):
        response = await ask_karina(text)
    
    # –ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π –≤—ã–≤–æ–¥ —Å –∫—É—Ä—Å–æ—Ä–æ–º ‚ñí
    words = text.split()
    for i in range(0, len(words), 4):
        await asyncio.sleep(0.6)
        await msg.edit(" ".join(words[:i+4]) + " ‚ñí")
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –ø–µ—á–∞—Ç–∏

### –£—Ä–æ–≤–µ–Ω—å 3: Fire-and-Forget

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–æ—Ç –∂–¥—ë—Ç –æ—Ç–≤–µ—Ç–∞ –æ—Ç –ë–î –ø–µ—Ä–µ–¥ –æ—Ç–≤–µ—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

**–†–µ—à–µ–Ω–∏–µ:**

```python
background_tasks = set()

def fire_and_forget(coro):
    task = loop.create_task(coro)
    background_tasks.add(task)
    task.add_done_callback(background_tasks.discard)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
update_user_cache(user_id, {"state": "WAITING_CODE"})
fire_and_forget(mcp_vpn_update_user_state(user_id, "WAITING_CODE"))
# –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é!
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –û—Ç–≤–µ—Ç –∑–∞ 0.01 —Å–µ–∫ –≤–º–µ—Å—Ç–æ 0.5 —Å–µ–∫

---

## üìà –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| **–ö–æ–Ω–≤–µ—Ä—Å–∏—è** | ~60% (NEW ‚Üí REGISTERED) |
| **–°—Ä–µ–¥–Ω–∏–π —á–µ–∫** | 400 ‚ÇΩ (3 –º–µ—Å—è—Ü–∞) |
| **LTV** | 1200 ‚ÇΩ (12 –º–µ—Å—è—Ü–µ–≤) |
| **–†–µ—Ñ–µ—Ä–∞–ª—ã** | 10% –æ—Ç –ø—Ä–æ–¥–∞–∂ |
| **–°–∫–æ—Ä–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞** | 0.01 —Å–µ–∫ (—Å –∫—ç—à–µ–º) |
| **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞** | 2-5 —Å–µ–∫ |

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç –Ω–∞–∫—Ä—É—Ç–∫–∏

```python
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Ñ–µ—Ä–µ—Ä–∞
if user.get("referred_by"):
    referrer_id = user["referred_by"]
    
    # –ù–µ–ª—å–∑—è —Ä–µ—Ñ–µ—Ä–∏—Ç—å —Å–∞–º–æ–≥–æ —Å–µ–±—è
    if referrer_id == user_id:
        logger.warning(f"Self-referral attempt: {user_id}")
        return
    
    # –ù–∞—á–∏—Å–ª–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–∏
    commission = calculate_referral_commission(amount)
    await mcp_vpn_update_balance(referrer_id, commission)
```

### Rate Limiting

```python
# –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–æ–≤
if await mcp_vpn_get_user(user_id):
    await event.respond("‚ö†Ô∏è –ê–∫–∫–∞—É–Ω—Ç —É–∂–µ —Å–æ–∑–¥–∞–Ω")
    raise events.StopPropagation
```

---

## üéØ Roadmap

### P0 (–ö—Ä–∏—Ç–∏—á–Ω—ã–µ)
- [ ] –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π (–°–ë–ü API)
- [ ] Webhook –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ–± –æ–ø–ª–∞—Ç–µ
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

### P1 (–í–∞–∂–Ω—ã–µ)
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ –≤ Mini App
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç (Bitcoin Lightning)
- [ ] –ú—É–ª—å—Ç–∏—è–∑—ã—á–Ω–æ—Å—Ç—å (RU/EN)

### P2 (–°—Ä–µ–¥–Ω–∏–µ)
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä–∏–æ–¥ (1 –¥–µ–Ω—å)
- [ ] –ü—Ä–æ–º–æ–∫–æ–¥—ã
- [ ] –ì—Ä—É–ø–ø–æ–≤—ã–µ —Ç–∞—Ä–∏—Ñ—ã

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** `docs/VPN_SHOP_*.md`
- **–õ–æ–≥–∏:** `tail -f bot.log | grep VPN`
- **Marzban API:** `http://108.165.174.164:8000/docs`

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 28 —Ñ–µ–≤—Ä–∞–ª—è 2026 –≥.
