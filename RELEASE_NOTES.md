# üìù Patch Notes ‚Äî Karina AI v1.1

**–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:** 24 —Ñ–µ–≤—Ä–∞–ª—è 2026 –≥.  
**–í–µ—Ä—Å–∏—è:** 1.1 (VPN Shop Release)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ Production Ready

---

## üéØ –ß—Ç–æ –Ω–æ–≤–æ–≥–æ –≤ v1.1

### üîê VPN Shop (–î–≤–æ–π–Ω–æ–µ –¥–Ω–æ)

**–ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—á–∏–π –º–∞–≥–∞–∑–∏–Ω VPN –¥–æ—Å—Ç—É–ø–æ–≤:**

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è VLESS –∫–ª—é—á–µ–π
- ‚úÖ QR-–∫–æ–¥—ã –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
- ‚úÖ –ü—Ä—è–º—ã–µ —Å—Å—ã–ª–∫–∏ vless://...
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Marzban API
- ‚úÖ SSH —Ç—É–Ω–Ω–µ–ª—å –º–µ–∂–¥—É —Å–µ—Ä–≤–µ—Ä–∞–º–∏
- ‚úÖ –ê–≤—Ç–æ-–ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ (Autossh)

**–î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
1. `/start` ‚Üí VPN Shop –º–µ–Ω—é
2. –í—ã–±–æ—Ä —Ç–∞—Ä–∏—Ñ–∞ (1 –º–µ—Å/3 –º–µ—Å)
3. –û–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ –°–ë–ü
4. –ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –≤—ã–¥–∞—á–∞ –∫–ª—é—á–∞ + QR

---

### üé≠ –ü—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å –º–µ–Ω—é –∫–æ–º–∞–Ω–¥

**–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞:**

| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å | –ú–µ–Ω—é –∫–æ–º–∞–Ω–¥ | Mini App |
|--------------|-------------|----------|
| **–í–ª–∞–¥–µ–ª–µ—Ü (MY_ID)** | ‚úÖ 23 –∫–æ–º–∞–Ω–¥—ã | ‚úÖ –ö–Ω–æ–ø–∫–∞ "–ö–∞—Ä–∏–Ω–∞ App" |
| **–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ** | ‚ùå –ü—É—Å—Ç–æ–µ | ‚ùå –°–∫—Ä—ã—Ç–æ |

**–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
- `BotCommandScopePeer` ‚Äî –∫–æ–º–∞–Ω–¥—ã —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
- `BotCommandScopeDefault` ‚Äî –ø—É—Å—Ç–æ –¥–ª—è –≤—Å–µ—Ö
- `BotMenuButton` ‚Äî –∫–Ω–æ–ø–∫–∞ Mini App —Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞

---

### üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —É–ª—É—á—à–µ–Ω–∏—è

#### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ SSH –∫–ª—é—á–∏ Ed25519 –≤–º–µ—Å—Ç–æ –ø–∞—Ä–æ–ª–µ–π
- ‚úÖ Autossh –¥–ª—è –∞–≤—Ç–æ-–ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
- ‚úÖ –û—Ç–∫–ª—é—á–µ–Ω–∞ –ø–∞—Ä–æ–ª—å–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- ‚úÖ –¢—É–Ω–Ω–µ–ª—å 8000:127.0.0.1:8000

#### –ö–æ–¥
- ‚úÖ UUID –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –¥–ª—è VLESS –∫–ª—é—á–µ–π
- ‚úÖ Inbounds –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ VLESS
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (VPNError, VPNConnectionError)
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (JSON/text)
- ‚úÖ Rate limiting –¥–ª—è API endpoints
- ‚úÖ LRU –∫—ç—à –¥–ª—è –∏—Å—Ç–æ—Ä–∏–∏ —á–∞—Ç–æ–≤

#### –¢–µ—Å—Ç—ã
- ‚úÖ 35 unit-—Ç–µ—Å—Ç–æ–≤ (CircuitBreaker, VPN, Reminders)
- ‚úÖ pytest –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ 91% –ø–æ–∫—Ä—ã—Ç–∏–µ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –º–æ–¥—É–ª–µ–π

---

## üìÅ –ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã

```
brains/
  ‚îú‚îÄ‚îÄ exceptions.py        # –ò–µ—Ä–∞—Ä—Ö–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π
  ‚îú‚îÄ‚îÄ vpn_api.py           # Marzban API –∫–ª–∏–µ–Ω—Ç
  ‚îú‚îÄ‚îÄ rate_limiter.py      # Rate limiting
  ‚îú‚îÄ‚îÄ chat_history.py      # LRU –∫—ç—à –∏—Å—Ç–æ—Ä–∏–∏
  ‚îî‚îÄ‚îÄ ai_tools.py          # AI tool executor

tests/
  ‚îú‚îÄ‚îÄ __init__.py
  ‚îú‚îÄ‚îÄ test_circuit_breaker.py
  ‚îú‚îÄ‚îÄ test_vpn_api.py
  ‚îî‚îÄ‚îÄ test_reminders.py

docs/
  ‚îú‚îÄ‚îÄ VPN_SHOP_SETUP.md    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ VPN Shop
  ‚îú‚îÄ‚îÄ VPN_SHOP_TESTING.md  # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
  ‚îú‚îÄ‚îÄ VPN_SHOP_FINAL.md    # –§–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è
  ‚îî‚îÄ‚îÄ LOGGING.md           # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

.env.example               # –®–∞–±–ª–æ–Ω –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
pyproject.toml            # pytest –∫–æ–Ω—Ñ–∏–≥
```

---

## üîß –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
```
qrcode[pil]==8.0      # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤
pytest==8.3.3         # –¢–µ—Å—Ç—ã
pytest-asyncio==0.24.0
```

**–£–¥–∞–ª–µ–Ω–æ:**
```
torch                 # ~2GB (TTS –æ—Ç–∫–ª—é—á–µ–Ω)
torchaudio
silero-tts
```

---

## üêõ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –±–∞–≥–∏

| –û—à–∏–±–∫–∞ | –†–µ—à–µ–Ω–∏–µ |
|--------|---------|
| `BotCommandScopeUser` –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω `BotCommandScopePeer` |
| TLObject expected error | `get_input_entity(MY_ID)` |
| Marzban –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç 127.0.0.1 | –ó–∞–º–µ–Ω–∞ –≤ –∫–æ–¥–µ + `.env` |
| VLESS –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ | –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `inbounds` |
| `MessageNotModifiedError` | try/except –≤ callback |
| –ü—É—Å—Ç–∞—è subscription —Å—Å—ã–ª–∫–∞ | UUID –≥–µ–Ω–µ—Ä–∞—Ü–∏—è + inbounds |

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

| –ú–µ—Ç—Ä–∏–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---------|----------|
| –°—Ç—Ä–æ–∫ –∫–æ–¥–∞ | ~8000+ |
| –ú–æ–¥—É–ª–µ–π | 11 |
| –ö–æ–º–∞–Ω–¥ –±–æ—Ç–∞ | 23 |
| –¢–µ—Å—Ç–æ–≤ | 35 |
| –î–æ–∫—É–º–µ–Ω—Ç–æ–≤ | 15+ |

---

## üöÄ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **Mini App –∫–Ω–æ–ø–∫–∞** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö Telegram
2. **TTS** ‚Äî –æ—Ç–∫–ª—é—á–µ–Ω (–ø—Ä–æ–±–ª–µ–º—ã —Å Silero v5)
3. **Python 3.10** ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ—Ç Google (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)
4. **Marzban –±–µ–∑ SSL** ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ —Ç—É–Ω–Ω–µ–ª—å

---

## üìà Roadmap (v1.2)

- [ ] –ü—Ä–∏—ë–º –ø–ª–∞—Ç–µ–∂–µ–π (–ÆKassa/Robokassa)
- [ ] –ê–≤—Ç–æ-–ø—Ä–æ–¥–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫
- [ ] –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ –≤ Mini App
- [ ] –†–µ—Ñ–µ—Ä–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- [ ] –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç (Lightning)

---

**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** Qwen Code AI  
**–î–∞—Ç–∞:** 24 —Ñ–µ–≤—Ä–∞–ª—è 2026 –≥.  
**–°–ª–µ–¥—É—é—â–∏–π —Ä–µ–ª–∏–∑:** v1.2 (–ú–∞—Ä—Ç 2026)
