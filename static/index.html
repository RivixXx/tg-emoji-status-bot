<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Karina Admin Panel</title>
    
    <!-- Скрипты -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* Базовые стили для надежности */
        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            overflow: hidden; background-color: #020617; 
            color: #ffffff; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        /* Фон с Кариной */
        .bg-karina {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(to bottom, rgba(2, 6, 23, 0.4), rgba(2, 6, 23, 0.9)), url('karina.jpg');
            background-size: cover; background-position: center;
            z-index: -1;
        }

        /* Пузыри */
        .bubble {
            position: absolute; border-radius: 50%;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: transform 0.2s;
            box-shadow: inset 0 4px 15px rgba(255,255,255,0.1), 0 10px 20px rgba(0,0,0,0.3);
            animation: float 12s infinite ease-in-out;
            pointer-events: auto;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) translateX(0); }
            33% { transform: translateY(-40px) translateX(20px); }
            66% { transform: translateY(-20px) translateX(-20px); }
        }

        /* Карточка Glassmorphism */
        .glass-card {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            padding: 24px;
            width: 90%; max-width: 400px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        .pop-effect { animation: pop 0.3s forwards; }
        @keyframes pop { 
            0% { transform: scale(1); } 
            50% { transform: scale(1.3); opacity: 0.5; } 
            100% { transform: scale(0); opacity: 0; } 
        }

        .scroll-hide::-webkit-scrollbar { display: none; }
        .scroll-hide { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div class="bg-karina"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const Bubble = ({ icon, label, onClick, delay, size, top, left, color }) => {
            const [popped, setPopped] = useState(false);
            
            const handleClick = (e) => {
                e.stopPropagation();
                setPopped(true);
                setTimeout(() => {
                    onClick();
                    setPopped(false);
                }, 300);
            };

            return (
                <div 
                    className={`bubble ${popped ? 'pop-effect' : ''}`}
                    style={{ 
                        width: size, height: size, top: top, left: left,
                        animationDelay: delay, borderTop: `2px solid ${color}`
                    }}
                    onClick={handleClick}
                >
                    <i className={`fa-solid ${icon} text-2xl mb-1`} style={{ color: color }}></i>
                    <span className="text-[10px] font-bold uppercase tracking-tighter" style={{ color: color }}>{label}</span>
                </div>
            );
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState(null);
            const [status, setStatus] = useState({ emoji: '...', health_confirmed: true });
            const [events, setEvents] = useState([]);
            const [search, setSearch] = useState("");
            const [memories, setMemories] = useState("");

            useEffect(() => {
                fetchData();
            }, []);

            const fetchData = async () => {
                try {
                    const [resStatus, resCal] = await Promise.all([
                        fetch('/api/status'),
                        fetch('/api/calendar')
                    ]);
                    setStatus(await resStatus.json());
                    const calData = await resCal.json();
                    setEvents(calData.events || []);
                } catch (e) { console.error("Data fetch error", e); }
            };

            const handleSearch = async () => {
                if (!search) return;
                const res = await fetch(`/api/memory/search?q=${encodeURIComponent(search)}`);
                const data = await res.json();
                setMemories(data.results);
            };

            return (
                <div className="relative w-full h-full overflow-hidden">
                    {/* Главный экран */}
                    <div className={`w-full h-full transition-opacity duration-500 ${activeTab ? 'opacity-20 pointer-events-none' : 'opacity-100'}`}>
                        <header className="absolute top-12 left-0 w-full text-center px-4">
                            <h1 className="text-5xl font-black italic tracking-tighter text-white drop-shadow-2xl">KARINA</h1>
                            <div className="h-1 w-20 bg-sky-500 mx-auto mt-2 rounded-full shadow-[0_0_10px_rgba(56,189,248,0.8)]"></div>
                        </header>

                        <Bubble icon="fa-calendar-check" label="Планы" size="100px" top="25%" left="10%" delay="0s" color="#38bdf8" onClick={() => setActiveTab('calendar')} />
                        <Bubble icon="fa-brain" label="Память" size="110px" top="42%" left="52%" delay="2s" color="#c084fc" onClick={() => setActiveTab('memory')} />
                        <Bubble icon="fa-heart-pulse" label="Статус" size="95px" top="65%" left="15%" delay="4s" color="#fb7185" onClick={() => setActiveTab('status')} />
                        <Bubble icon="fa-gear" label="Опции" size="85px" top="18%" left="65%" delay="1s" color="#94a3b8" onClick={() => {}} />
                    </div>

                    {/* Модальное окно */}
                    {activeTab && (
                        <div className="absolute inset-0 z-50 flex items-center justify-center p-4 bg-black/20 backdrop-blur-sm" onClick={() => setActiveTab(null)}>
                            <div className="glass-card" onClick={e => e.stopPropagation()}>
                                <div className="flex justify-between items-center mb-6">
                                    <h2 className="text-xl font-bold flex items-center gap-3">
                                        <i className={`fa-solid ${activeTab === 'calendar' ? 'fa-calendar text-sky-400' : activeTab === 'memory' ? 'fa-brain text-purple-400' : 'fa-heart-pulse text-rose-400'}`}></i>
                                        {activeTab === 'calendar' ? 'Ближайшие планы' : activeTab === 'memory' ? 'Память Карины' : 'Статус системы'}
                                    </h2>
                                    <button onClick={() => setActiveTab(null)} className="w-8 h-8 flex items-center justify-center rounded-full bg-white/10 hover:bg-white/20">
                                        <i className="fa-solid fa-times"></i>
                                    </button>
                                </div>

                                {activeTab === 'calendar' && (
                                    <div className="space-y-3 max-h-72 overflow-y-auto pr-2 scroll-hide">
                                        {events.length > 0 ? events.map((ev, i) => (
                                            <div key={i} className="bg-white/5 p-4 rounded-2xl border-l-4 border-sky-400 text-sm leading-relaxed">
                                                {ev}
                                            </div>
                                        )) : <p className="text-center text-slate-400 italic py-8">Планов пока не найдено...</p>}
                                    </div>
                                )}

                                {activeTab === 'memory' && (
                                    <div>
                                        <div className="flex gap-2 mb-4">
                                            <input 
                                                type="text" value={search} onChange={(e) => setSearch(e.target.value)}
                                                placeholder="О чем вспомнить?" 
                                                className="w-full bg-black/40 border border-white/10 rounded-2xl px-4 py-3 text-sm focus:outline-none focus:border-purple-500"
                                            />
                                            <button onClick={handleSearch} className="bg-purple-500 w-12 rounded-2xl flex items-center justify-center shadow-lg shadow-purple-500/20">
                                                <i className="fa-solid fa-search"></i>
                                            </button>
                                        </div>
                                        {memories && (
                                            <div className="bg-black/40 p-4 rounded-2xl text-xs text-slate-300 whitespace-pre-wrap max-h-48 overflow-y-auto border border-white/5">
                                                {memories}
                                            </div>
                                        )}
                                    </div>
                                )}

                                {activeTab === 'status' && (
                                    <div className="grid grid-cols-2 gap-4">
                                        <div className="bg-white/5 p-5 rounded-3xl text-center border border-white/5 shadow-inner">
                                            <p className="text-[10px] text-slate-400 uppercase font-black mb-2 tracking-widest">Аура</p>
                                            <p className="text-4xl">{status.emoji || '✨'}</p>
                                        </div>
                                        <div className={`bg-white/5 p-5 rounded-3xl text-center border border-white/5 shadow-inner`}>
                                            <p className="text-[10px] text-slate-400 uppercase font-black mb-2 tracking-widest">Здоровье</p>
                                            <div className="flex flex-col items-center">
                                                <span className={`w-3 h-3 rounded-full mb-1 ${status.health_confirmed ? 'bg-emerald-500' : 'bg-rose-500 animate-pulse'}`}></span>
                                                <p className="text-sm font-bold uppercase tracking-tighter">{status.health_confirmed ? 'Норма' : 'Укол!'}</p>
                                            </div>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
